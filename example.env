# Environment variables for Garak Report Repository

# Directory where Garak report files are stored
# Default: ./data (relative to project root)
# If not set, defaults to ./data
REPORT_DIR=./data

# Path handling with security validation:
# - Relative paths (like ./data) are resolved from the project root
# - Absolute paths are allowed but validated for security
# - All paths are checked to prevent directory traversal attacks
#
# Example configurations:
# REPORT_DIR=./data                    # Relative to project root
# REPORT_DIR=./reports                 # Subdirectory of project root
# REPORT_DIR=../reports                # Parent directory of project
# REPORT_DIR=/home/user/garak-reports  # Absolute path
# REPORT_DIR=/var/log/garak/reports    # System directory

NODE_ENV=development

# ==============================================================================
# AUTHENTICATION CONFIGURATION
# ==============================================================================

# Enable/disable OIDC authentication
# - Set to 'false' to disable authentication (app will work without login)
# - Set to 'true' to require OIDC authentication
# Default: true (OIDC required)
OIDC_ENABLED=true

# ==============================================================================
# NextAuth Configuration
# ==============================================================================
# These variables are used by NextAuth.js for session management

# REQUIRED when OIDC_ENABLED=true:
#   Both NEXTAUTH_URL and NEXTAUTH_SECRET must be explicitly set
#   The application will exit with an error if they are missing
#
# OPTIONAL when OIDC_ENABLED=false:
#   - NEXTAUTH_URL defaults to http://localhost:3000 if not set
#   - NEXTAUTH_SECRET is auto-generated (random 64-char hex) if not set

NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-nextauth-secret-key-here

# ==============================================================================
# OIDC Provider Configuration
# ==============================================================================
# These variables configure OIDC authentication with automated service discovery
# The system will automatically discover provider endpoints from the issuer URL

# REQUIRED when OIDC_ENABLED=true:
#   All three variables (ISSUER, CLIENT_ID, CLIENT_SECRET) must be set
#   The application will exit with an error if any are missing

OIDC_ISSUER=https://your-oidc-provider.com
OIDC_CLIENT_ID=your-client-id
OIDC_CLIENT_SECRET=your-client-secret

# Set this to true if you need debug logging to troubleshoot an OIDC connection
OIDC_DEBUG=false

# Optional OIDC Configuration
# Provider name for display purposes
OIDC_PROVIDER_NAME=Your OIDC Provider

# Scopes to request (comma-separated)
# Default: openid,profile,email
# Note: Only specify scopes that are supported by your OIDC provider
OIDC_SCOPES=openid,profile,email

# Security settings
OIDC_USE_PKCE=true
OIDC_USE_NONCE=true
OIDC_USE_STATE=true

# Session configuration
OIDC_MAX_AGE=3600

# Optional: Override discovered endpoints (usually not needed)
# OIDC_AUTHORIZATION_ENDPOINT=https://your-provider.com/auth
# OIDC_TOKEN_ENDPOINT=https://your-provider.com/token
# OIDC_USERINFO_ENDPOINT=https://your-provider.com/userinfo
# OIDC_JWKS_URI=https://your-provider.com/.well-known/jwks.json
# OIDC_END_SESSION_ENDPOINT=https://your-provider.com/logout

# Example configurations for common OIDC providers:

# Okta Configuration
# OIDC_ISSUER=https://your-domain.okta.com/oauth2/default
# OIDC_CLIENT_ID=your-okta-client-id
# OIDC_CLIENT_SECRET=your-okta-client-secret
# OIDC_PROVIDER_NAME=Okta
# OIDC_SCOPES=openid,profile,email

# Google Configuration
# OIDC_ISSUER=https://accounts.google.com
# OIDC_CLIENT_ID=your-google-client-id
# OIDC_CLIENT_SECRET=your-google-client-secret
# OIDC_PROVIDER_NAME=Google
# OIDC_SCOPES=openid,profile,email

# Azure AD Configuration
# OIDC_ISSUER=https://login.microsoftonline.com/your-tenant-id/v2.0
# OIDC_CLIENT_ID=your-azure-client-id
# OIDC_CLIENT_SECRET=your-azure-client-secret
# OIDC_PROVIDER_NAME=Azure AD
# OIDC_SCOPES=openid,profile,email

# Auth0 Configuration
# OIDC_ISSUER=https://your-domain.auth0.com
# OIDC_CLIENT_ID=your-auth0-client-id
# OIDC_CLIENT_SECRET=your-auth0-client-secret
# OIDC_PROVIDER_NAME=Auth0
# OIDC_SCOPES=openid,profile,email

# Keycloak Configuration
# OIDC_ISSUER=https://your-keycloak.com/realms/your-realm
# OIDC_CLIENT_ID=your-keycloak-client-id
# OIDC_CLIENT_SECRET=your-keycloak-client-secret
# OIDC_PROVIDER_NAME=Keycloak
# OIDC_SCOPES=openid,profile,email

# AWS Cognito Configuration
# OIDC_ISSUER=https://cognito-idp.region.amazonaws.com/user-pool-id
# OIDC_CLIENT_ID=your-cognito-client-id
# OIDC_CLIENT_SECRET=your-cognito-client-secret
# OIDC_PROVIDER_NAME=AWS Cognito
# OIDC_SCOPES=openid,profile,email

# Report Read-Only Configuration
# Controls whether the repository is in read-only mode
# When set to true, all state-changing operations are disabled:
#   - Report uploads are blocked
#   - Vulnerability score editing is disabled
#   - Upload UI elements are hidden
#   - To add reports in readonly mode, manually copy .jsonl files to REPORT_DIR
# When set to false (default), users can upload reports and edit vulnerability scores
REPORT_READONLY=false

# Shared Secret Authentication for Machine-to-Machine Communication
# This enables API authentication using a shared secret for automated services
# When set, API endpoints can be accessed using:
# - X-API-Key: <shared-secret> (case-insensitive header name)
# 
# If not set (or empty), shared secret authentication is disabled
# and the system falls back to OIDC authentication or no authentication
# depending on the OIDC_ENABLED config value
# SHARED_SECRET=your-shared-secret-here

# ==============================================================================
# CACHE CONFIGURATION
# ==============================================================================

# Maximum memory limit for the in-memory LRU cache (in megabytes)
# The cache is used to store report metadata to improve performance
# when loading reports, which can be CPU-intensive for large files (~300MB)
# 
# Default: 100 (100MB)
# The cache automatically evicts least-recently-used entries when the limit is reached
# Each cached metadata entry is approximately 7KB
# 
# Example configurations:
# CACHE_MAX_MEMORY_MB=100   # 100MB (default, suitable for most deployments)
CACHE_MAX_MEMORY_MB=100

